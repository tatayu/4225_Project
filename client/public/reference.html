<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link
            rel="icon"
            href="https://www.siot.gov.sg/images/siot_logo_ico.ico"
        />
        <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css?family=Lato:400,600"
            crossorigin="anonymous"
        />
        <!--href="{{&env.SERVER_URL}}api/css/smart_locker_landing_page.css" -->
        <link
            rel="stylesheet"
            href="{{&env.SERVER_URL}}api/css/smart_locker_landing_page.css"
        />
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
        <script src="https://unpkg.com/sweetalert@2.1.2/dist/sweetalert.min.js"></script>
        <title>Smart Locker System</title>
    </head>
    <body>
        <nav class="navbar bg-white">
            <h1>
                <img
                    src="https://www.siot.gov.sg/images/siot_logo_combi_side_color.png"
                    alt="Homepage"
                />
            </h1>
        </nav>
        <section class="landing">
            <div class="landing-inner">
                <h1 class="large">Smart Locker System</h1>
                <!-- <p class="lead">
                    Fast and easy way to deposit and collect items
                </p> -->
                <ul>
                    <li>
                        <form action="#" class="depositionForm">
                            <h2 class="lead">Deposition</h2>
                            <div class="depositionForm-group">
                                <input
                                    type="number"
                                    placeholder="Your Phone Number"
                                    id="depositionSenderNumber"
                                    required
                                />
                            </div>
                            <div class="depositionForm-group">
                                <input
                                    type="number"
                                    placeholder="Receiver Phone Number"
                                    id="depositionReceiverNumber"
                                    required
                                />
                            </div>
                            <div class="depositionForm-group">
                                <input
                                    type="text"
                                    placeholder="Item Description"
                                    id="description"
                                    required
                                />
                            </div>
                            <input
                                type="submit"
                                value="Deposit"
                                class="btn btn-primary"
                            />
                        </form>
                    </li>
                    <li>
                        <form action="#" class="collectionForm">
                            <h2 class="lead">Collection</h2>
                            <div class="collectionForm-group">
                                <input
                                    type="number"
                                    placeholder="Your Phone Number"
                                    id="collectionReceiverNumber"
                                    required
                                />
                            </div>
                            <input
                                type="submit"
                                value="Collect"
                                class="btn btn-primary"
                            />
                        </form>
                    </li>
                    <li>
                        <p>
                            Not a member?
                            <a
                                href="https://apps.siotgov.tech/apps/soll/form-server-generate-form-staging/api/forms/getHtml/Smart_Locker/Create_User/Create_User"
                                >Register</a
                            >
                        </p>
                    </li>
                </ul>
            </div>
        </section>
        <script>
            const depositionForm = document.querySelector('.depositionForm');
            if (depositionForm) {
                deposition(depositionForm);
            }

            function deposition(depositionForm) {
                depositionForm.addEventListener('submit', async (e) => {
                    try {
                        e.preventDefault();
                        const senderNumber = document.querySelector(
                            `#depositionSenderNumber`
                        );
                        const receiverNumber = document.querySelector(
                            `#depositionReceiverNumber`
                        );
                        const description =
                            document.querySelector(`#description`);

                        console.log(senderNumber.id);
                        console.log(senderNumber.value);
                        console.log(receiverNumber.id);
                        console.log(receiverNumber.value);
                        console.log(description.id);
                        console.log(description.value);

                        const config = {
                            headers: {
                                'Content-Type': 'application/json',
                            },
                        };

                        const body = {
                            [senderNumber.id]: senderNumber.value,
                            [receiverNumber.id]: receiverNumber.value,
                            [description.id]: description.value,
                        };
                        const currentURL = window.location.href;
                        const advId = currentURL.split('/').pop();
                        console.log(advId);
                        await axios
                            .post(
                                '{{&env.SERVER_URL}}api/smart_locker/getHtml/Smart_Locker/Landing_Page/Landing_Page/' +
                                    advId +
                                    '/deposition',
                                body,
                                config
                            )
                            .then((res) => {
                                console.log(res);
                                if (res.data === 'found') {
                                    swal(
                                        'Success!',
                                        'A one-time link has send to your mobile number, please use the link to unlock the locker.',
                                        'success'
                                    ).then(function () {
                                        location.reload();
                                    });
                                } else {
                                    swal('Error!', `${res.data}`, 'error').then(
                                        function () {
                                            location.reload();
                                        }
                                    );
                                }
                            });
                    } catch (err) {
                        console.log(err);
                    }
                });
            }

            const collectionForm = document.querySelector('.collectionForm');
            if (collectionForm) {
                collection(collectionForm);
            }

            function collection(collectionForm) {
                collectionForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    const receiverNumber = document.querySelector(
                        `#collectionReceiverNumber`
                    );
                    console.log(receiverNumber.id);
                    console.log(receiverNumber.value);

                    const config = {
                        headers: {
                            'Content-Type': 'application/json',
                        },
                    };

                    const body = { [receiverNumber.id]: receiverNumber.value };
                    //console.log(body);
                    const currentURL = window.location.href;
                    const advId = currentURL.split('/').pop();
                    const res = await axios
                        .post(
                            '{{&env.SERVER_URL}}api/smart_locker/getHtml/Smart_Locker/Landing_Page/Landing_Page/' +
                                advId +
                                '/collection',
                            body,
                            config
                        )
                        .then((res) => {
                            console.log(res);
                            if (res.data === 'found') {
                                swal(
                                    'Success!',
                                    'A one-time link has send to your mobile number, please use the link to unlock the locker.',
                                    'success'
                                ).then(function () {
                                    location.reload();
                                });
                            } else {
                                swal('Error!', `${res.data}`, 'error').then(
                                    function () {
                                        location.reload();
                                    }
                                );
                            }
                        });
                });
            }
        </script>
    </body>
</html>
